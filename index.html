
<!DOCTYPE html><html lang="en"><head><title>Python Testing Like a Pro -- Keith Yang</title><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="shower/material/styles/screen-16x10.css"/><link rel="stylesheet" href="font-awesome/css/font-awesome.min.css"/><link rel="stylesheet" href="pygments.css"/><link rel="stylesheet" href="index.css"/></head><body class="shower list">
<header class="caption"><h1>Python Testing like a Pro</h1><h2>Coding test-driven Python package<br/>with CI and Cloud</h2><h2 class="name revertfg">Keith Yang</h2><br/><h3 class="note text-right">2017 August</h3></header><section id="front" class="slide loading text-center"><h2 class="focustitle">Python Testing like a Pro ðŸš€</h2><h3 class="subject focustitle">Keith Yang</h3><img src="pictures/formosat-5-launch.jpg" alt="" width="100%" class="cover"/>
<br/>
<br/>
<br/>
<br/>
<br/>
<div class="note text-center">Formosat-5 launching</div></section><section class="slide"><h2>Coding test-driven Python package with CI and cloud <i class="fa fa-cloud"></i></h2><h3 class="text-center">My talk in PyCon APAC 2017</h3><br/><h4 class="text-center"><a href="mailto:yang@keitheis.org">yang@keitheis.org</a></h4><h4 class="text-center">@keitheis <a href="https://twitter.com/keitheis"><i class="fa fa-twitter"></i></a> <a href="https://github.com/keitheis"><i class="fa fa-github"></i></a></h4></section><section class="slide"><h2>alog v.s. OpenStack</h2>Difference?
<pre><code class="next"><div class="codehilite">keithis/alog &lt;master&gt;<br/>% find . -name <span class="s1">&#39;*.py&#39;</span> <span class="p">|</span> xargs cat <span class="p">|</span> wc -l<br/><span class="m">418</span><br/></div></code></pre><h3 class="next">Total 418 Python lines of code in <code>alog</code></h3></section><section class="slide"><h2>Versus Over 20,000,000 Lines<br/>of Code of</h2><img src="pictures/openstack.png" alt="OpenStack" width="100%"/></section><section class="slide"><h2>The same part: <mark>BUG FREE</mark>!<span class="next">?<img src="pictures/bugspread.png" alt="" width="100%"/></span></h2></section><section class="slide"><img src="pictures/echostarxxiiilaunch.jpg" alt="Another Launching Image" width="100%" class="cover"/></section><section class="slide text-center"><h2>Keith Yang</h2><h3>Software Engineering Artisan</h3><h4>Caring from code, tesitng, to delivery on Web & Cloud</h4><img src="pictures/keith-avatar.png" alt="Keith's avatar" class="avatar"/><h4 class="note">Founder of <a href="http://taipei.python.org.tw/">@Taipeipy</a> since 2012<br/>Chairpersion of <a href="https://tw.pycon.org/2015apac/">PyCon APAC 2015</a><br/>Cloud Senior Engineer in <a href="https://www.ichefpos.com/">iCHEF</a></h4><style>img.avatar {
  margin: 0.6em;
  width: 64px;
  border-style: none;
  border-radius: 3px;
  box-sizing: border-box;
  display: inline-block;
  overflow: hidden;
  line-height: 1;
  vertical-align: middle; }</style></section><section class="slide"><h2>Abstract</h2><ul><li><mark>Perspectives</mark> and <mark>categories</mark> of software testing</li><li>Abstract <mark>workflow</mark> and <mark>concepts</mark></li><li>Pragmatic <mark>tools</mark> and some <mark>tips</mark></li></ul></section><section class="slide"><h2>Expected Experience</h2>

<ul>
<li>Tested app and/or code</li>
<li>Unit Testing</li>
<li>Continuous Integration (CI)</li>
<li>Plus: heard of
<ul>
<li>Test-driven Development (TDD)</li>
<li>Continuous Delivery (CD)</li>
</ul></li>
</ul></section><section class="slide"><h2>For participating a serious project</h2><div class="text-center"><a href="https://wiki.openstack.org/wiki/Testing">https://wiki.openstack.org/wiki/Testing</a></div><img src="pictures/openstack_testing.png" alt="Testing in OpenStack" width="80%"/></section><section class="slide"><h2>Testing in an OpenStack project</h2><ul><li>Unit Tests</li><li>Style Checks</li><li>Integration Tests</li><li>Product Tests</li></ul></section><section class="slide"><h2 class="shout">Perspectives<br/>& Categories</h2></section><section class="slide"><h2 class="note"><i class="fa fa-info-circle"></i> Note</h2><p class="note">Some terms <mark>marked</mark> in the following slides for easier remember while going through slides.</p></section><section class="slide"><h2>Software Application Categories</h2><table class="fs-s"><tr><td>Accounting</td><td>Airline</td><td>Banking</td><td>Commerce</td></tr><tr><td>Compiler</td><td>Protocols</td><td>Cryptography</td><td>Embedded system</td></tr><tr><td>Finance</td><td>Games</td><td>Manufacturing</td><td>Music</td></tr><tr><td>Science</td><td>Training</td><td>Voting</td><td>Web browser</td></tr><tr><td>Router</td><td><mark>Cloud architecture</mark></td><td>OS</td><td>Robotic</td></tr><tr><td colspan="4">Image, speech, or handwriting processing</td></tr></table></section><section class="slide"><h2 class="next">by Human?</h2><img src="pictures/titanic-2003.jpg" alt="Titanic 2003" class="cover"/></section><section class="slide"><h2>Software Testing Topic</h2><ul><li><mark>Scope</mark> ðŸ—º</li><li>Functional vs non-functional testing</li><li>Defects and failures</li><li>Static vs dynamic testing</li><li>Software testing ream</li></ul></section><section class="slide"><h2>Testing Methods</h2>Box approach<ul><li><i class="fa fa-square-o"></i> White box</li><li><i class="fa fa-square"></i> Black box</li><li><i class="fa fa-plus-square"></i> <mark>Grey box testing</mark></li></ul></section><section class="slide"><h2><i class="fa fa-level-up"></i> Testing levels <i class="fa fa-level-down"></i></h2><ul><li>Unit testing</li><li><mark>Integration testing</mark></li><li>System testing</li><li>System integration testing</li><li>Regression testing</li><li>Alpha and Beta testing</li></ul></section><section class="slide"><h2>Non-functional testing</h2><ul><li>Performance and load testing</li><li>Stability testing</li><li>Usability testing</li><li><mark>Security testing</mark></li><li>Internationalization and localization</li><li>Destructive testing</li></ul></section><section class="slide"><h2>Testing Process</h2><ul><li>Traditional CMMI or waterfall development model</li><li><mark>Agile</mark> or Extreme development model</li><li>A sample testing cycle</li></ul></section><section class="slide"><h2 class="shout">No enough experience?<br/><span class="fs-xs">No<span class="kblack next">t really a blocking</span> problem!</span></h2></section><section class="slide"><h2 class="shout">Learn from<br/>Open Source!</h2></section><section class="slide"><h2><i class="fa fa-github"></i> keitheis/alog</h2><a href="https://github.com/keitheis/alog" class="note fs-xs">https://github.com/keitheis/alog</a><img src="pictures/alog-coverage.png" alt="coverage and pypi version badges of alog" width="80%" class="next"/></section><section class="slide"><h2 class="shout">build | passing</h2></section><section class="slide"><h2>Builds on Travis CI</h2><img src="pictures/alog-on-travisci.png" alt="Build results of alog on Travis CI" width="100%"/></section><section class="slide"><h2>Concept <i class="fa fa-envelope"></i> Confirm Action Success</h2><h3>Use Email, IM notification</h3><img src="pictures/travisci-email-alog-ok.png" alt="Build results of alog on Travis CI" width="100%"/></section><section class="slide"><h2>Concept <i class="fa fa-bell"></i> Alert on Broken</h2><h3>Use Email, SMS notification</h3><img src="pictures/alog-on-travisci-broken.png" alt="Build results of alog on Travis CI" width="100%"/><p class="note next text-center">NO, it's me! Ask me to fix it!</p></section><section class="slide"><h2 class="shout">codecov | 100%</h2></section><section class="slide"><h2>Coverages Report on Codecov</h2><img src="pictures/codecov-report-alog.png" alt="Coverage report of alog on Codecov" width="70%"/></section><section class="slide"><h2>Files coverage of alog on Codecov</h2><img src="pictures/coverages-of-alog-files.png" alt="Coverage of alog files on Codecov" width="100%"/><p class="note next text-center">It looks 100% good.</p></section><section class="slide"><h2>Lines coverage of alog module</h2><img src="pictures/lines-coverage-of-alog.png" alt="Coverage lines of an alog module" width="100%"/></section><section class="slide"><h2>Coverage ðŸ’¯ %?</h2><ul><li>Some lines marked ignored from coverage</li><li>Not integration tests</li></ul><ul class="next"><li>Totally <b>NOT</b> bug free</li><li>Most lines were <b>executed</b></li></ul></section><section class="slide"><h2 class="shout">pypi | v0.9.13</h2></section><section class="slide"><h2>Package ready on (new) PyPI</h2><img src="pictures/alog-package-on-pypi.png" alt="Alog package page on PyPI" width="100%"/></section><section class="slide"><h2 class="shout">How? Tox!</h2></section><section class="slide"><h2><i class="fa fa-github"></i> tox-dev/tox</h2><blockquote>virtualenv management and test command line tool</blockquote>
<pre><code class="next"><div class="codehilite"># content of: tox.ini , put in same dir as setup.py<br/>[tox]<br/>envlist = py26,py27<br/>[testenv]<br/>deps=pytest&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; # install pytest in the venvs<br/>commands=pytest&nbsp; # or &#39;nosetests&#39; or ...<br/></div></code></pre></section><section class="slide"><h2><i class="fa fa-github"></i> tox-dev/tox</h2><blockquote>virtualenv management and test command line tool</blockquote><ul><li>Environment list</li><li>Dependences</li><li>Commands</li></ul></section><section class="slide fullcode"><h2>tox.ini of alog</h2>
<pre><code><div class="codehilite">[tox]<br/>envlist =<br/>&nbsp;&nbsp;&nbsp;&nbsp;py27,py33,py34,py35,py36,pypy,<br/>&nbsp;&nbsp;&nbsp;&nbsp;{py2,py3}-cover,coverage<br/><br/>[testenv]<br/>basepython =<br/>&nbsp;&nbsp;&nbsp;&nbsp;py27: python2.7<br/>&nbsp;&nbsp;&nbsp;&nbsp;...<br/>&nbsp;&nbsp;&nbsp;&nbsp;py36: python3.6<br/>&nbsp;&nbsp;&nbsp;&nbsp;pypy: pypy<br/>&nbsp;&nbsp;&nbsp;&nbsp;py2: python2.7<br/>&nbsp;&nbsp;&nbsp;&nbsp;py3: python3.4<br/></div></code></pre></section><section class="slide"><h2>Services Automation by GitHub</h2><ul><li>Webhooks<ul><li>Codecov</li></ul></li><li>Integrations & services<ul><li>Travis CI</li></ul></li><li class="next">There are alternatives!</li></ul></section><section class="slide fullcode"><h2>.travis.yml of alog</h2>
<pre><code><div class="codehilite">...<br/>install:<br/>&nbsp;&nbsp;&nbsp;&nbsp;- travis_retry pip install tox<br/>&nbsp;<br/>script:<br/>&nbsp;&nbsp;&nbsp;&nbsp;- travis_retry tox<br/>&nbsp;<br/>after_success:<br/>&nbsp;&nbsp;&nbsp;&nbsp;- bash &lt;(curl -s https://codecov.io/bash)<br/>&nbsp;<br/>notifications:<br/>&nbsp;&nbsp;&nbsp;&nbsp;email:<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- yang@keitheis.org<br/></div></code></pre></section><section class="slide fullcode"><h2>.travis.yml of alog</h2><ul><li>Install Tox</li><li>Test script <code class="next">tox</code></li><li>Run command after success</li><li>Notifications</li></ul></section><section class="slide fullcode"><h2>Tips of using Travis CI</h2><ul><li>Use Tox for diff envs</li><li><code>travis_retry</code><ul class="next"><li>Network timeout</li><li>Or unknown reasons</li><li>See <i>Common Build Problems</i> on its website</li></ul></li><li>Email notification</li></ul></section><section class="slide"><h2 class="shout">Hooray!<br/>Focus on Coding!</h2></section><section class="slide"><h2 class="shout">Wait...<br/>how about Jenkins?</h2></section><section class="slide"><h2>Fun Facts of Jenkins</h2><ul><li>Originally developed as the <mark>Hudson</mark> project.</li><li>Started in summer of <mark>2004</mark> at <mark>Sun</mark> Microsystems.</li><li>First released in <mark>java.net</mark> in Feb. 2005.</li></ul><br/><p class="note fs-s">https://en.wikipedia.org/wiki/Jenkins_(software)</p></section><section class="slide"><h2>Swift builds on Jenkins</h2><img src="pictures/jenkins-swift-project.png" alt="Customzied Jenkins page of Swift" width="100%"/></section><section class="slide"><h2>Code Coverage and Test Trend<br/>on Jenkins</h2><img src="pictures/code-coverage-test-trend-jenkins.png" alt="" width="50%"/><img src="pictures/jenkins.png" alt="" width="50%"/></section><section class="slide"><h2>Tips of Coverage on Jenkins</h2><ul><li>Fail the build if coverage obviously dropped</li><li>Use Docker (if suitable to the software) for testing multiple <mark>pull-requests</mark> testing parallelly</li><li>Let Jenkins do the deployment to share the knowhow</li><li>Fully CI/CD autumation isn't far far away</li></ul></section><section class="slide"><h2>Avoid keeping failing or</h2><div class="text-center"><img src="pictures/fire-jenkins.svg" alt="Fire Jenkins" width="50%"/></div></section><section class="slide"><h2 class="shout">What it is all for</h2></section><section class="slide"><h2><i>Keep failures before release</i></h2><h3 class="next">It's really hard.<br/>After release:</h3></section><section class="slide text-center"><h2 class="kblack">Even AWS Serveless Can Fail</h2><div><img src="pictures/aws-serverless-errors.png" alt="AWS Serveless Errors" width="100%"/></div></section><section class="slide text-center"><h2 class="kblack">My HeardBleed with OpenSSL</h2><div><img src="pictures/heartbleed-page.png" alt="Heardbleed Page" width="124%"/></div></section><section class="slide text-center"><h2 class="kblack next">A <span class="fs-s">Little</span> Less Surprise?</h2><div><img src="pictures/less-surprise-yahoo.png" alt="Yahoo Error Page" width="80%"/></div></section><section class="slide"><h2 class="shout"><i>Forget it,<br/>lets go back to CODE!</i></h2></section><section class="slide"><h2 class="shout">Don't forget it<br/>please ðŸ™‡</h2></section><section class="slide"><h2>Back to Python World <span class="next">Finally!</span></h2><p><mark>2 strategies</mark>will be focus here</p></section><section class="slide"><h2>Strategy 1. Show Me Errors Early</h2>Some tools<ul><li>IPython</li><li>Code Linter on IDE/Editors/CI</li><li>yapf</li><li>py.test</li><li>hyposesis</li></ul></section><section class="slide"><h2>IPython (& Jupyter Notebook)</h2><ul><li>Evaluate behaviors step by step</li><li>Explore current environment and variables</li><li>Consider use pdb for exceptions</li></ul></section><section class="slide"><h2>Step by Step Extension</h2><h3>Tip: Install IPython first</h3><ul><li>Pyramid <code>pshell --development.ini</code></li><li><code>pyramid_debugtoolbar</code> & <code>pyramid_ipython</code></li><li>Django Debug Toolbar</li><li>Django <code>python manage.py shell</code></li></ul></section><section class="slide"><h2>Code Linter on IDE/Editors/CI</h2><h3>Super helpful for human typo</h3><ul><li>Vim: syntastic, ale (with <code>flake8</code>)</li><li>Sublime Text Linter</li><li>Most IDEs: built-in</li></ul></section><section class="slide"><h2>Concept: WYSWYG</h2><h3>What you see is what you get</h3><h3 class="next">See it right right away!<img src="pictures/demo_storybook.gif" alt="React Storybook" width="130%"/></h3></section><section class="slide"><h2><i class="fa fa-github"></i> google/yapf</h2><blockquote>... based off of 'clang-format' ... In essence, the algorithm takes the code and reformats it to the best formatting that conforms to the style guide, ...</blockquote><blockquote>even if the original code <b>didn't violate</b> the style guide.</blockquote><h3 class="text-right next"><img src="pictures/questions.png" alt="???" width="50%"/></h3></section><section class="slide"><h2>Tips of using <code>yapf</code></h2><ul><li>Can be used to format thoudsands of legacy Python code that is hard to read by our <i>PEP8</i> built-in eyes.</li><li>Many options including Google and Facebook style to taste</li><blockquote class="next fs-s">YAPF is not an official Google product (experimental or otherwise), it is just code that happens to be owned by Google.</blockquote></ul></section><section class="slide"><h2 class="shout">py.test</h2></section><section class="slide"><h2>py.test</h2><blockquote>makes it easy to write <mark>small</mark> tests, yet <mark>scales</mark> to support <mark>complex</mark> functional testing for applications and libraries.</blockquote></section><section class="slide"><h2>Tips of using <code>py.test</code></h2><ul><li>Use it even <code>Python</code> and <code>Django</code> built-in unittest</li><li>Super handy to test a single module<br/>by <code>pytest app/tests/test_a_single.py</code></li><li>with <code>pytest-cov</code> and <code>--junitxml</code> for Jenkins</li><li>with <code>--lf</code> to just test last failures</li></ul></section><section class="slide"><h2>hyposesis</h2><blockquote>... lets you write tests which are parametrized by a source of examples, and then generates simple and comprehensible examples that make your tests fail.</blockquote></section><section class="slide"><h2>hyposesis</h2>
<pre><code><div class="codehilite"><span class="nd">@given</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">allow_nan</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">allow_infinity</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="n">min_size</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><br/><span class="k">def</span> <span class="nf">test_mean</span><span class="p">(</span><span class="n">xs</span><span class="p">):</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">assert</span> <span class="nb">min</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">mean</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><br/><br/><span class="n">Falsifying</span> <span class="n">example</span><span class="p">:</span> <span class="n">test_mean</span><span class="p">(</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">xs</span><span class="o">=</span><span class="p">[</span><span class="mf">1.7976321856e+308</span><span class="p">,</span> <span class="mf">6.102322755e+303</span><span class="p">]</span><br/><span class="p">)</span><br/></div></code></pre></section><section class="slide"><h2>Many to discover</h2><ul><li><code>freezegun</code> - Fix tesing <code>utc.now</code>!</li><li><code>Faker</code> - generate useful fake values</li><li><code>vcrpy</code> - recording API results</li><li><code>pip-tools</code> - separate testing requirements</li><li>...</li></ul></section><section class="slide"><h2 class="shout">unittest.mock</h2></section><section class="slide"><h2>Tips of <code>mock</code></h2><ul><li>Python 3 built-in</li><li><code>pip install mock</code></li><li>Let you focus on current pargs while fighting messy legacy code</li></ul><blockquote>Assert it works before and mock it with success result</blockquote></section><section class="slide"><h2>Strategy 2. Let Me Debug Easily</h2><ul><li>Sentry - logging runtime erros</li><li>IPython - have it on production</li><li>alog - have it on production<br/><span class="next">and benefit from it during development and testing</span></li></ul></section><section class="slide"><h2>Tips of Sentry</h2><ul><li>Separate different environments on Sentry by Sentry project - <b>much eaiser</b> to see urgent errors and debug</li><li>Can be great to have while working on legacy<br/>ðŸ‘‰ Integrate it during development</li></ul></section><section class="slide"><h2 class="shout">Because<br/>Things Happen</h2></section><section class="slide"><h2>Prepare most error handles during development</h2><p>You can invest the minimal time cost for maximum gain by paying attention during development</p><img src="pictures/payfirst.png" alt="Pay something before release" width="80%"/></section><section class="slide"><img src="pictures/jrti.png" alt="Just Read the Instructions" width="100%" class="cover"/></section><section class="slide"><h2>Some References</h2><ul><li><i>Test-Driven Python Development</i></li><li><i>Test-Driven Development with Python, 2nd Edition</i></li><li><i>Code Complete (2nd edition)</i></li><li><i>Building for Failure: Learning lessons from aviation</i> by @andrewgodwin</li></ul></section><section class="slide"><h2>Summary</h2><ul><li>Prepare your testing strategies</li><li>With best tools to help the workflow</li><li>Let errors be found as early as possible</li><li>Prepare runtime failures</li></ul></section><section class="slide"><h2 class="shout">No tested backup plan?<br/>equals no backup</h2></section><section class="slide"><h2 class="shout">Q&A<br/><span class="next">Enjoy</span></h2></section><section class="slide"><h2 class="shout">Thank you!<br/><span class="kblack next">Things Happen</span></h2></section><div class="progress"></div><!-- Copyright Â© 2017 Keith Yang -->
<script src="shower/shower.min.js">
</script><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-4248558-11', 'auto');
ga('send', 'pageview');</script><script src="local.js">
</script></body></html>